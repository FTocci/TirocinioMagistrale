<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Three.js</title>
    <style>
        body { margin: 0; }
         button {
            position: absolute;
            z-index: 1;
            background-color: gray;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <button id="zoomButtonIn" style="top: 10px; left: 10px;">Zoom Z</button>
    <button id="zoomButtonOut" style="top: 10px; left: 120px;">De-Zoom Z</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Variabili globali
        var scene, camera, renderer, transparentSphere, isRotating = false, subSphere;
        // Funzione per inizializzare la scena
        function init() {
            // Creiamo una scena
            scene = new THREE.Scene();
			scene.background = new THREE.TextureLoader().load( "textures/planetgalaxybackround.jpg" );
			
			var lontananza = 8;
            // Creiamo una telecamera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, lontananza);
            camera.position.z = lontananza;
			camera.zoom = 1.6;
			camera.updateProjectionMatrix();

            // Creiamo un renderizzatore
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

			//--------------------------------------------SFERA TRASPARENTE--------------------------------------------------------
            // Creiamo una sfera da posizionare al centro della scena
			var geometry = new THREE.SphereGeometry(1.5, 32, 32);

			// Creiamo un materiale trasparente
			var material = new THREE.MeshBasicMaterial({
				color: 0xffffff,
				transparent: true, // Imposta il materiale come trasparente
				opacity: 0.3, // Imposta il livello di opacità desiderato (0 = completamente trasparente, 1 = opaco)
				depthWrite: true // Impedisci che oggetti dietro la sfera siano nascosti
			});

			// Creiamo la mesh della sfera utilizzando il materiale
			transparentSphere = new THREE.Mesh(geometry, material);
			transparentSphere.position.set(0,0,0);
			scene.add(transparentSphere);
			
			//-----------------------------------SFERA NUCLEO-----------------------------------------------------------------------
			// Crea un materiale verde scuro
			//var materialSubSphere = new THREE.MeshPhongMaterial({ color: 0x006400 }); // Colore verde scuro
			
			var textureLoader = new THREE.TextureLoader();
			var texture = textureLoader.load("textures/earth/earthmap1k.jpg");
			var materialSubSphere = new THREE.MeshPhongMaterial({ map: texture })
			
			// Crea una geometria sferica
			var geometrySubSphere = new THREE.SphereGeometry(1, 16, 16);

			// Crea una mesh utilizzando la geometria e il materiale
			subSphere = new THREE.Mesh(geometrySubSphere, materialSubSphere);
			subSphere.position.set(transparentSphere.position.x, transparentSphere.position.y, transparentSphere.position.z);
			scene.add(subSphere);
			
			//----------------------------------SFERE EXTRA------------------------------------------------------------------------
			// Crea un materiale verde scuro
			var materialSphere2 = new THREE.MeshPhongMaterial({ color: 0x006400 }); // Colore verde scuro

			// Crea una geometria sferica
			var geometrySphere2 = new THREE.SphereGeometry(1, 32, 32);

			// Crea una mesh utilizzando la geometria e il materiale
			var Sphere2 = new THREE.Mesh(geometrySphere2, materialSphere2);
			Sphere2.position.set(-4,2, 0);
			scene.add(Sphere2);

			// Crea una mesh utilizzando la geometria e il materiale
			var Sphere2 = new THREE.Mesh(geometrySphere2, materialSphere2);
			Sphere2.position.set(4,-2, 0);
			scene.add(Sphere2);
			
			//----------------------------------LUCI-------------------------------------------------------------------------------
			// Aggiungi una luce ambientale per illuminare la scena
			var ambientLight = new THREE.AmbientLight(0x404040);
			scene.add(ambientLight);

			// Crea una luce direzionale
			var directionalLight = new THREE.DirectionalLight(0xffffff, 1);
			directionalLight.position.set(10, 10, 1);
			scene.add(directionalLight);
			
			//---------------------------------GRAFO--------------------------------------------------------------------------------
            // Creazione del grafo
            var nodeGeometry = new THREE.SphereGeometry(0.025, 6, 6); // Nodo del grafo
			var nodeMaterial = new THREE.MeshLambertMaterial({ color: 0x00AA00 });
            var lineMaterial = new THREE.LineBasicMaterial({ color: 0x006400, opacity: 0.75}); // Colore della linea

			// Numero di nodi da generare
			var numNodes = 1000;
			var nodes = [];
			var lines = [];

			// Creazione dei nodi
			function generateRandomCoordinates() {
				var u = Math.random(); // Uniformemente distribuito tra 0 e 1
				var v = Math.random(); // Uniformemente distribuito tra 0 e 1

				var theta = 2 * Math.PI * u; // Angolo orizzontale da 0 a 2π
				var phi = Math.acos(2 * v - 1); // Angolo verticale da 0 a π

				var x = Math.sin(phi) * Math.cos(theta); // Calcolo delle coordinate sferiche
				var y = Math.sin(phi) * Math.sin(theta);
				var z = Math.cos(phi);

				// Moltiplica per il raggio della sfera (1.5)
				var radius = 1.5;
				x *= radius;
				y *= radius;
				z *= radius;

				return { x, y, z };
			}
			
			// Creazione dei nodi
			for (var i = 0; i < numNodes; i++) {
				var node = new THREE.Mesh(nodeGeometry, nodeMaterial);
				var position = generateRandomCoordinates();
				node.position.set(position.x, position.y, position.z);
				nodes.push(node);
			}
			
			

			// Aggiungi i nodi alla sfera principale
			for (var i = 0; i < numNodes; i++) {
				transparentSphere.add(nodes[i]);	
			}
			// Aggiungi gli archi alla sfera principale
			for(var i=0; i<2000; i++){
				nodoA=nodes[Math.floor(Math.random()*nodes.length)];
				do{
					nodoB=nodes[Math.floor(Math.random()*nodes.length)];
				}while(nodoA===nodoB);
				
				var dx = nodoA.position.x - nodoB.position.x;
				var dy = nodoA.position.y - nodoB.position.y;
				var dz = nodoA.position.z - nodoB.position.z;

				var distance = Math.sqrt(dx * dx + dy * dy + dz * dz);

				if(distance <= 1.5){
					var line = new THREE.Line(new THREE.BufferGeometry().setFromPoints([nodoA.position, nodoB.position]), lineMaterial);
					transparentSphere.add(line);
				}
			}
			//-----------------------------------BOTTONI E FUNZIONALITà----------------------------------------------------
            // Registriamo l'evento per la pressione del tasto "Space"
            document.addEventListener('keydown', function (event) {
                if (event.keyCode === 32) {
                    isRotating = !isRotating;
                }
            });
			// Ottieni il riferimento al bottone
			var zoomButtonIn = document.getElementById("zoomButtonIn");
			var zoomButtonOut = document.getElementById("zoomButtonOut");
			
			var zoomCount=0;
			// Aggiungi un gestore di eventi al bottone
			zoomButtonIn.addEventListener("click", function() {
				// Modifica la posizione Z della telecamera
				var zoomAmount = 1; // Modifica questa quantità come desideri
				camera.position.z -= zoomAmount;
				zoomCount += 1;
			});
			zoomButtonOut.addEventListener("click", function() {
				// Modifica la posizione Z della telecamera
				if(zoomCount>0){
					var zoomAmount = 1; // Modifica questa quantità come desideri
					camera.position.z += zoomAmount;
					zoomCount -= 1;
				}
				
			});

            animate();
        }

        // Funzione per animare la scena
        function animate() {
            requestAnimationFrame(animate);

            if (isRotating) {
                // Ruotiamo le sfere solo se isRotating è true
                transparentSphere.rotation.x += 0.01;
                transparentSphere.rotation.y += 0.01;
                subSphere.rotation.y += 0.01;
                
            }

            renderer.render(scene, camera);
        }
		

        // Inizializziamo la scena
        init();
    </script>
</body>
</html>
