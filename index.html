<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Three.js</title>
    <style>
        body { margin: 0; }
         button {
            position: absolute;
            z-index: 1;
            background-color: gray;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <button id="zoomButton">Zoom Z</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Variabili globali
        var scene, camera, renderer, transparentSphere, isRotating = false;
		
        // Funzione per inizializzare la scena
        function init() {
            // Creiamo una scena
            scene = new THREE.Scene();
			scene.background = new THREE.TextureLoader().load( "textures/planetgalaxybackround.jpg" );
			
            // Creiamo una telecamera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 8;

            // Creiamo un renderizzatore
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Creiamo una sfera da posizionare al centro della scena
			var geometry = new THREE.SphereGeometry(1.5, 32, 32);

			// Creiamo un materiale trasparente
			var material = new THREE.MeshBasicMaterial({
				color: 0xffffff,
				transparent: true, // Imposta il materiale come trasparente
				opacity: 0.5, // Imposta il livello di opacità desiderato (0 = completamente trasparente, 1 = opaco)
				depthWrite: true // Impedisci che oggetti dietro la sfera siano nascosti
			});

			// Creiamo la mesh della sfera utilizzando il materiale
			transparentSphere = new THREE.Mesh(geometry, material);
			transparentSphere.position.set(0,0,0);
			scene.add(transparentSphere);
			
			//creazione Sfera 2
			Sphere2 = new THREE.Mesh(geometry, material);
			Sphere2.position.set(5,1.5,0);
			scene.add(Sphere2);
			
			//creazione Sfera 3
			Sphere3 = new THREE.Mesh(geometry, material);
			Sphere3.position.set(-5,1,0);
			scene.add(Sphere3);
			
			var spheres =[Sphere3,transparentSphere,Sphere2];
			
            // Creazione dei grafi
            var nodeGeometry = new THREE.SphereGeometry(0.025, 16, 16); // Nodo del grafo
			
			// Crea il materiale con riflessione speculare
			var nodeMaterial = new THREE.MeshPhongMaterial({
				color: 0x00AA00, // Colore del nodo
				specular: 0xffffff, // Colore del riflesso speculare
				shininess: 30 // Intensità della speculare
			});
			
			var light = new THREE.DirectionalLight( 0xffffff );	//luce direzionale sul singolo nodo
			light.position.set( 0, 1, 1 );
			scene.add(light);

            var lineMaterial = new THREE.LineBasicMaterial({ color: 0x00FF00 }); // Colore della linea

			// Numero di nodi da generare
			function generateNodes(numNodes){
				nodes = [];
				var lines = [];

				// Creazione dei nodi del grafo
				function generateRandomCoordinates() {
					// Genera numeri casuali
					var x, y, z;
					var lengthSquared;
					do {
						x = Math.random() * 2 - 1; // Numeri casuali tra -1 e 1
						y = Math.random() * 2 - 1;
						z = Math.random() * 2 - 1;
						lengthSquared = x * x + y * y + z * z;
					} while (lengthSquared === 0); // Continua finché lengthSquared è uguale a 0

					// Normalizza i numeri
					var length = Math.sqrt(lengthSquared);
					x /= length;
					y /= length;
					z /= length;

					// Moltiplica per il raggio della sfera (1.5)
					var radius = 1.5;
					x *= radius;
					y *= radius;
					z *= radius;

					return { x, y, z };
				}

				// Creazione dei nodi della sfera
				for (var i = 0; i < numNodes; i++) {
					var node = new THREE.Mesh(nodeGeometry, nodeMaterial);
					var position = generateRandomCoordinates();
					node.position.set(position.x, position.y, position.z);
					nodes.push(node);

					/*if (i > 0) {
						// Creazione delle linee tra i nodi
						var prevNode = nodes[i - 1];
						var line = new THREE.Line(new THREE.BufferGeometry().setFromPoints([prevNode.position, node.position]), lineMaterial);
						lines.push(line);
					}*/
				}
				return nodes;
			}
			
			var num = 100;
			// Aggiungi i nodi e le linee alle sfere
			for (var j = 0; j < spheres.length; j++) {
				nodi = generateNodes(num);
				for(var i = 0; i < nodi.length; i++){
					spheres[j].add(nodi[i]);
				}
				num *= 5;
			}



            // Aggiungiamo una luce
            //var light = new THREE.PointLight(0xffffff,10,0);
            //light.position.set(0, 0, 0);
			//scene.add(light);

            // Registriamo l'evento per la pressione del tasto "Space"
            document.addEventListener('keydown', function (event) {
                if (event.keyCode === 32) {
                    isRotating = !isRotating;
                }
            });
			
			// Ottieni il riferimento al bottone
			var zoomButton = document.getElementById("zoomButton");

			// Aggiungi un gestore di eventi al bottone
			zoomButton.addEventListener("click", function() {
				// Modifica la posizione Z della telecamera
				var zoomAmount = 1; // Modifica questa quantità come desideri
				camera.position.z -= zoomAmount;
			});
			
            animate();
        }

        // Funzione per animare la scena
        function animate() {
            requestAnimationFrame(animate);

            if (isRotating) {
                // Ruotiamo le sfere solo se isRotating è true
                transparentSphere.rotation.x += 0.01;
                transparentSphere.rotation.y += 0.01;
				Sphere2.rotation.x += 0.01;
                Sphere2.rotation.y += 0.01;
				Sphere3.rotation.x += 0.01;
                Sphere3.rotation.y += 0.01;
            }
            renderer.render(scene, camera);
        }
		

        // Inizializziamo la scena
        init();
    </script>
</body>
</html>
